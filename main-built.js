/*
 * Canvas.js – Part of FIL (The Front-end Interactive Libraries)
 * Copyright (c) 2012, Danny Garcia. All rights reserved.
 * Code licensed under the MIT License
 * https://github.com/dannyx0/fil/
 */

/*
 * Input.js – Part of FIL (The Front-end Interactive Libraries)
 * Copyright (c) 2012, Danny Garcia. All rights reserved.
 * Code licensed under the MIT License
 * https://github.com/dannyx0/fil/
 */

/*
 * Pen.js – Part of FIL (The Front-end Interactive Libraries)
 * Copyright (c) 2012, Danny Garcia. All rights reserved.
 * Code licensed under the MIT License
 * https://github.com/dannyx0/fil/
 */

/*
 * Frame.js – Part of FIL (The Front-end Interactive Libraries)
 * Copyright (c) 2012, Danny Garcia. All rights reserved.
 * Code licensed under the MIT License
 * https://github.com/dannyx0/fil/
 */

/*
 * Transformer.js – Part of FIL (The Front-end Interactive Libraries)
 * Copyright (c) 2012, Danny Garcia. All rights reserved.
 * Code licensed under the MIT License
 * https://github.com/dannyx0/fil/
 */

define("src/Canvas",[],function(){var e={context:"2d",container:document.body,width:"auto",height:"auto",resize:!1,ratio:!0},t=null,n=null,r=1;return{width:null,height:null,init:function(t){typeof t!="undefined"&&this.options(t),typeof window.devicePixelRatio!="undefined"&&e.ratio&&(r=window.devicePixelRatio),canvas=e.container.appendChild(document.createElement("canvas")),this.context(e.context),this.resize(null,e.width,e.height),e.resize&&window.addEventListener("resize",this.resize,!1)},options:function(t){if(typeof t=="undefined")return e;for(var n in e)e.hasOwnProperty(n)&&typeof t[n]!="undefined"&&(e[n]=t[n])},context:function(e){return typeof e=="undefined"?context:(context=canvas.getContext(e),context)},resize:function(t,n,i){if(typeof n=="undefined"||n==="auto")n=e.container.offsetWidth;if(typeof i=="undefined"||i==="auto")i=e.container.offsetHeight;n*=r,i*=r,this.width=context.canvas.width=n,this.height=context.canvas.height=i,canvas.style.width=n/r,canvas.style.height=i/r},clear:function(){context.clearRect(0,0,this.width,this.height)},destroy:function(){e.resize&&window.removeEventListener("resize",this.resize,!1),e.container.removeChild(canvas),e={context:"2d",container:document.body,width:"auto",height:"auto",resize:!1},canvas=null,context=null,r=1,dimensions={}}}}),define("src/Input",[],function(){var e={element:document.body,preventDefault:!1,ratio:!0},t=1,n=!1,r=function(e,t){var n,r,i;return typeof t=="string"&&(n=e[t],t=e,e=n),typeof e!="function"?undefined:(r=Array.prototype.slice.call(arguments,2),i=function(){return e.apply(t,r.concat(Array.prototype.slice.call(arguments)))},i.guid=e.guid=e.guid||i.guid,i)};return{inputs:[],average:{},init:function(r){typeof r!="undefined"&&this.options(r),typeof window.devicePixelRatio!="undefined"&&e.ratio&&(t=window.devicePixelRatio),n=this.supportsTouch(),this.bindAllInputs()},options:function(t){if(typeof t=="undefined")return e;for(var n in e)e.hasOwnProperty(n)&&typeof t[n]!="undefined"&&(e[n]=t[n])},setCoordinates:function(r,i){e.preventDefault&&r.preventDefault();var s=[],o={x:0,y:0};if(n)for(var u=0;u<r.touches.length;u++)s[u]={x:r.touches[u].pageX*t,y:r.touches[u].pageY*t},o.x+=s[u].x,o.y+=s[u].y;else s[0]={x:r.pageX*t,y:r.pageY*t},o=s[0];this.inputs=s,this.average={x:Math.ceil(o.x/s.length),y:Math.ceil(o.y/s.length)}},bindAllInputs:function(){this.bindTapStart(),this.bindTapMove(),this.bindTapEnd()},unbindAllInputs:function(){this.unbindTapStart(),this.unbindTapMove(),this.unbindTapEnd()},bindTapStart:function(){var t=this.getEventType("start");e.element.addEventListener(t,r(this.tapStart,this),!1)},tapStart:function(e){this.setCoordinates(e,"start"),this.ontapstart(this.average,this.inputs)},ontapstart:function(e,t){},unbindTapStart:function(){var t=this.getEventType("start");e.element.removeEventListener(t,r(this.tapStart,this),!1)},bindTapMove:function(){var t=this.getEventType("move");e.element.addEventListener(t,r(this.tapMove,this),!1)},tapMove:function(e){this.setCoordinates(e,"move"),this.ontapmove(this.average,this.inputs)},ontapmove:function(e,t){},unbindTapMove:function(){var t=this.getEventType("move");e.element.removeEventListener(t,r(this.tapMove,this),!1)},bindTapEnd:function(){var t=this.getEventType("end");e.element.addEventListener(t,r(this.tapEnd,this),!1)},tapEnd:function(e){this.setCoordinates(e,"end"),this.ontapend(this.average,this.inputs)},ontapend:function(e,t){},unbindTapEnd:function(){var t=this.getEventType("end");e.element.removeEventListener(t,r(this.tapEnd,this),!1)},getEventType:function(e){var t=n?"touch":"mouse";return e==="start"&&!n?e="down":e==="end"&&!n&&(e="up"),t+e},supportsTouch:function(){return"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch},destroy:function(){this.unbindAllInputs()}}}),define("src/Pen",[],function(){return{ctx:null,context:function(e){if(typeof e=="undefined"){if(this.ctx===null)throw"You must provide a [ctx] to draw on. Try setting it with context(ctx)";return this.ctx}this.ctx=e},fill:function(e){var t=this.context();t.fillStyle=e},stroke:function(e,t){var n=this.context();e&&(n.strokeStyle=e),t&&n.lineWidth(t)},line:function(e,t){var n=this.context();n.beginPath(),n.moveTo(e.x,e.y),n.lineTo(t.x,t.y),n.stroke()},circle:function(e,t){var n=this.context();n.beginPath(),n.arc(e.x,e.y,t,0,Math.PI*2,!0),n.closePath(),n.fill()}}}),define("src/Frame",[],function(){return{active:!1,request:null,frame:0,step:function(e){},start:function(){if(!this.active){var e=this,t=function(){e.request=window.requestAnimationFrame(t),e.step(e.frame),e.frame++};typeof window.requestAnimationFrame=="undefined"&&(window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}()),typeof window.cancelAnimationFrame=="undefined"&&(window.cancelAnimationFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame}()),t(),this.active=!0}},stop:function(){this.active&&window.cancelAnimationFrame(this.request)}}}),define("src/Transformer",[],function(){return this._contains=function(t,n){return!!~(""+t).indexOf(n)},this._prefixed=function(e,t){var n="Webkit Moz O ms".split(" "),r=e.charAt(0).toUpperCase()+e.slice(1),i=(e+" "+n.join(r+" ")+r).split(" "),s,o;for(s in i){o=i[s];if(!this._contains(o,"-")&&t[o]!==undefined)return o}return!1},{transform:function(e,t){typeof e=="undefined"&&(e=this.el),this.el=e;var n,r="";for(n in t)r+=n+"("+t[n]+") ";e.style[_prefixed("transform",e.style)]=r},transformOrigin:function(e,t,n){typeof e=="undefined"&&(e=this.el),this.el=e,e.style[_prefixed("transformOrigin",e.style)]=t+" "+n}}}),require(["src/Canvas","src/Input","src/Pen","src/Frame","src/Transformer"],function(e,t,n,r,i){var s=function(e,t){e="http://jsonp.jit.su/?url="+e;var n=new XMLHttpRequest;n.open("GET",e,!0),n.send(),n.onreadystatechange=function(e){e.target.status===200&&e.target.readyState===4&&t(JSON.parse(e.target.response))}},o=function(t){var r=this,o=70,u=20;this.level=0,this.struct=[],this.c={},this.el=document.getElementById("tooltip"),this.timeout=!1,this.distance=function(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)},this.update=function(e){this.c=e,this.changePosition(this.struct,!0),this.drawTree(this.struct)},this.setItemPosition=function(e,t,n){var r=this;return e.pos={x:t.x,y:t.y,_x:n._x,_y:n._y,level:r.level},e},this.changePosition=function(e,t){var n,i,s,o,u=Math.random()*360;t&&(r.level=0);for(o=0;o<e.length;o++)n=e[o].item,i=e[o].parent.item,s=o/e.length*360+u,n.angle={_x:10*Math.cos(s*Math.PI/180),_y:10*Math.sin(s*Math.PI/180)},n.pos||r.setItemPosition(n,i.pos,n.angle),n.max=(n.type==="dir"?100:50)+e.length,n.distance=this.distance(n.pos,i.pos),n.distance<=n.max&&(n.pos.x+=n.pos._x,n.pos.y+=n.pos._y),e[o].children&&(r.level+=1,r.changePosition(e[o].children));n=null,i=null,s=null,u=null,o=null},this.showToolTip=function(e,t){e.x=Math.ceil(e.x),e.y=Math.ceil(e.y),n.circle(e,12),this.el.textContent=t.name,this.el.textContent+=t.type==="dir"?"/":"",this.el.style.backgroundColor="rgb("+t.pos.level/r.level*255+",0,0)",i.transform(this.el,{translateX:e.x+"px",translateY:e.y+"px"})},this.drawTree=function(e){for(var t=0;t<e.length;t++){var i=e[t];i.item.pos&&(typeof this.c.x!="undefined"&&typeof this.c.y!="undefined"&&this.c.x>i.item.pos.x-u&&this.c.x<i.item.pos.x+u&&this.c.y>i.item.pos.y-u&&this.c.y<i.item.pos.y+u&&this.showToolTip(i.item.pos,i.item),n.stroke("rgb("+Math.ceil(i.item.pos.level/r.level*255)+",0,0)"),n.fill("rgb("+Math.ceil(i.item.pos.level/r.level*255)+",0,0)"),n.line(i.item.pos,i.parent.item.pos),n.circle(i.item.pos,i.item.type==="dir"?10:5)),i.children&&r.drawTree(i.children),item=null}},this.addBranch=function(e,t){s(t._links.self+"?cacheBust="+(new Date).getTime(),function(t){r.processTree(e.children,t,e)})},this.processTree=function(e,t,n){var i,s;for(s=0;s<t.length;s++)i=t[s],e[s]={item:i},i.type==="dir"&&(e[s].children=[],r.addBranch(e[s],e[s].item)),e[s].parent=n?n:!1},typeof t=="undefined"&&(t="dannyx0/fil"),s("https://api.github.com/repos/"+t+"/contents/?cacheBust="+(new Date).getTime(),function(t){r.processTree(r.struct,t,{item:{pos:{x:e.width/2,y:e.height/2,_x:0,_y:0,level:0}}})})},u=function(e,t){this.pos=e,this.draw=function(e){n.circle(this.pos,t.type==="folder"?10:5)}},a=function(){var i=document.getElementById("canvas"),s=document.getElementById("form"),u,a=!1;s.addEventListener("submit",function(e){e.preventDefault();var t=document.getElementById("user").value,n=document.getElementById("repo").value,r=t+"/"+n;u=new o(r),window.location.hash=r},!1),t.init({ratio:!1}),e.init({container:i,ratio:!1});var f=e.context();f.lineStroke="#000",n.context(f);var l={},c={};t.ontapmove=function(e){c=e},window.location.hash?(a=window.location.hash.replace("#",""),u=new o(a),document.getElementById("user").value=a.split("/")[0],document.getElementById("repo").value=a.split("/")[1]):u=new o,r.start(),r.step=function(t){e.clear(),u.update(c)}};a()}),define("src/main",function(){})