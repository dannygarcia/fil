<!doctype html>
<html class="no-js" lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>fil : Front-end Interactive Libraries</title>
	<meta name="author" content="Danny Garcia">
	<meta name="viewport" content="user-scalable=no">

	<link rel="stylesheet" href="style.css">

	<script>/*
 * fil.min.js – FIL (The Front-end Interactive Libraries)
 * Copyright (c) 2012, Danny Garcia. All rights reserved.
 * Code licensed under the MIT License
 * https://github.com/dannygarcia/fil/
 */var fil=fil||{};(function(e){"use strict";var t=function(){var e,t={context:"2d",container:document.body,width:"auto",height:"auto",resize:!1,ratio:!1},n=null,r=null,i=1;return{width:null,height:null,init:function(e){return typeof e!="undefined"&&this.options(e),typeof window.devicePixelRatio!="undefined"&&t.ratio&&(i=window.devicePixelRatio),n=t.container.appendChild(document.createElement("canvas")),r=this.context(t.context),this.resize(null,t.width,t.height),t.resize&&window.addEventListener("resize",this.resize,!1),this},options:function(e){if(typeof e=="undefined")e=t;else for(var n in t)t.hasOwnProperty(n)&&typeof e[n]!="undefined"&&(t[n]=e[n]);return e},context:function(e){return typeof e=="undefined"?r:(r=n.getContext(e),r)},resize:function(e,s,o){if(typeof s=="undefined"||s==="auto")s=t.container.offsetWidth;if(typeof o=="undefined"||o==="auto")o=t.container.offsetHeight;s*=i,o*=i,this.width=r.canvas.width=s,this.height=r.canvas.height=o,n.style.width=s/i,n.style.height=o/i},clear:function(){r.clearRect(0,0,this.width,this.height)},destroy:function(){t.resize&&window.removeEventListener("resize",this.resize,!1),n&&t.container.removeChild(n),t={context:"2d",container:document.body,width:"auto",height:"auto",resize:!1},n=null,r=null,i=1}}};e.Canvas=t,typeof this.define=="function"&&this.define.amd&&this.define("Canvas",[],function(){return e.Canvas})}).call(this,function(){return this.fil=this.fil||{},this.fil}.call(this)),function(e){"use strict";var t=function(){return{active:!1,request:null,frame:0,step:function(e){},start:function(){if(!this.active){var e=this,t=function(){e.request=window.requestAnimationFrame(t),e.step(e.frame),e.frame++};typeof window.requestAnimationFrame=="undefined"&&(window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}()),typeof window.cancelAnimationFrame=="undefined"&&(window.cancelAnimationFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame}()),t(),this.active=!0}},stop:function(){this.active&&window.cancelAnimationFrame(this.request)}}};e.Frame=t,typeof this.define=="function"&&this.define.amd&&this.define("Frame",[],function(){return e.Frame})}.call(this,function(){return this.fil=this.fil||{},this.fil}.call(this)),function(e){"use strict";var t=function(){var e={element:document.body,preventDefault:!1,ratio:!1,forceTouch:!1,type:"object"},t=1,n=!1,r=!1,i=function(e,t){var n,r,i;return typeof t=="string"&&(n=e[t],t=e,e=n),typeof e!="function"?undefined:(r=Array.prototype.slice.call(arguments,2),i=function(){return e.apply(t,r.concat(Array.prototype.slice.call(arguments)))},i.guid=e.guid=e.guid||i.guid,i)};return{inputs:[],average:{},init:function(n){return typeof n!="undefined"&&this.options(n),typeof window.devicePixelRatio!="undefined"&&e.ratio&&(t=window.devicePixelRatio),r=e.forceTouch||this.supportsTouch(),this.bindAllInputs(),this},options:function(t){if(typeof t=="undefined")return e;for(var n in e)e.hasOwnProperty(n)&&typeof t[n]!="undefined"&&(e[n]=t[n])},setCoordinates:function(n){e.preventDefault&&n.preventDefault();var i=[],s=e.type==="object"?{x:0,y:0}:[0,0];if(r)for(var o=0;o<n.touches.length;o++)i[o]=e.type==="object"?{x:n.touches[o].pageX*t,y:n.touches[o].pageY*t}:[n.touches[o].pageX*t,n.touches[o].pageY*t],e.type==="object"?(s.x+=i[o].x,s.y+=i[o].y):(s[0]+=i[o][0],s[1]+=i[o][1]);else i[0]=e.type==="object"?{x:n.pageX*t,y:n.pageY*t}:[n.pageX*t,n.pageY*t],s=i[0];this.inputs=i,this.average=e.type==="object"?{x:Math.ceil(s.x/i.length),y:Math.ceil(s.y/i.length)}:[Math.ceil(s[0]/i.length),Math.ceil(s[1]/i.length)]},bindAllInputs:function(){n=!0,this.bindTapStart(),this.bindTapMove(),this.bindTapEnd()},unbindAllInputs:function(){n&&(this.unbindTapStart(),this.unbindTapMove(),this.unbindTapEnd()),n=!1},bindTapStart:function(){var t=this.getEventType("start");e.element.addEventListener(t,i(this.tapStart,this),!1)},tapStart:function(e){this.setCoordinates(e,"start"),this.ontapstart(this.average,this.inputs)},ontapstart:function(e,t){},unbindTapStart:function(){var t=this.getEventType("start");e.element.removeEventListener(t,i(this.tapStart,this),!1)},bindTapMove:function(){var t=this.getEventType("move");e.element.addEventListener(t,i(this.tapMove,this),!1)},tapMove:function(e){this.setCoordinates(e,"move"),this.ontapmove(this.average,this.inputs)},ontapmove:function(e,t){},unbindTapMove:function(){var t=this.getEventType("move");e.element.removeEventListener(t,i(this.tapMove,this),!1)},bindTapEnd:function(){var t=this.getEventType("end");e.element.addEventListener(t,i(this.tapEnd,this),!1)},tapEnd:function(e){this.setCoordinates(e,"end"),this.ontapend(this.average,this.inputs)},ontapend:function(e,t){},unbindTapEnd:function(){var t=this.getEventType("end");e.element.removeEventListener(t,i(this.tapEnd,this),!1)},getEventType:function(e){var t=r?"touch":"mouse";return e==="start"&&!r?e="down":e==="end"&&!r&&(e="up"),t+e},supportsTouch:function(){return"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch},destroy:function(){this.unbindAllInputs()}}};e.Input=t,typeof this.define=="function"&&this.define.amd&&this.define("Input",[],function(){return e.Input})}.call(this,function(){return this.fil=this.fil||{},this.fil}.call(this)),function(e){"use strict";var t=function(){return{ctx:null,context:function(e){if(typeof e=="undefined"){if(this.ctx===null)throw"You must provide a [ctx] to draw on. Try setting it with context(ctx)";return this.ctx}return this.ctx=e,this.ctx},fill:function(e){var t=this.context();t.fillStyle=e},stroke:function(e,t){var n=this.context();e&&(n.strokeStyle=e),t&&(n.lineWidth=t)},line:function(e,t,n){n=n||"object";var r=this.context();r.beginPath(),n==="array"?(r.moveTo(e[0],e[1]),r.lineTo(t[0],t[1])):(r.moveTo(e.x,e.y),r.lineTo(t.x,t.y)),r.stroke()},circle:function(e,t,n){n=n||"object";var r=this.context();r.beginPath(),n==="array"?r.arc(e[0],e[1],t,0,Math.PI*2,!0):r.arc(e.x,e.y,t,0,Math.PI*2,!0),r.closePath(),r.fill()}}};e.Pen=t,typeof this.define=="function"&&this.define.amd&&this.define("Pen",[],function(){return e.Pen})}.call(this,function(){return this.fil=this.fil||{},this.fil}.call(this)),function(e){"use strict";var t=function(){var e=this;return this._contains=function(t,n){return!!~(""+t).indexOf(n)},this._prefixed=function(e,t){var n="Webkit Moz O ms".split(" "),r=e.charAt(0).toUpperCase()+e.slice(1),i=(e+" "+n.join(r+" ")+r).split(" "),s,o;for(s in i){o=i[s];if(!this._contains(o,"-")&&t[o]!==undefined)return o}return!1},{transform:function(t,n){typeof t=="undefined"&&(t=this.el),this.el=t;var r,i="";if(n instanceof Array)for(var s=0;s<n.length;s++)i+=n[s].property+"("+n[s].value+") ";else for(r in n)i+=r+"("+n[r]+") ";t.style[e._prefixed("transform",t.style)]=i},transformOrigin:function(t,n,r){typeof t=="undefined"&&(t=this.el),this.el=t,t.style[e._prefixed("transformOrigin",t.style)]=n+" "+r}}};e.Transformer=t,typeof this.define=="function"&&this.define.amd&&this.define("Transformer",[],function(){return e.Transformer})}.call(this,function(){return this.fil=this.fil||{},this.fil}.call(this));</script>
</head>
<body>

	<div id="canvas"></div>

	<div id="description">
		<h1><a href="https://github.com/dannygarcia/fil/">FIL</a>: Front-end Interactive Libraries</h1>
		<form id="form">
			<input type="text" id="user" placeholder="GitHub User" required /><input type="text" id="repo" placeholder="User's Repo" required /><input type="submit" value="go" />
		</form>
	</div>

	<div id="tooltip"></div>

<iframe src="http://ghbtns.com/github-btn.html?user=dannygarcia&repo=fil&type=watch&size=large&count=true"
  allowtransparency="true" frameborder="0" scrolling="0" width="152px" height="30px"
  style="
    position: fixed;
    bottom: 20px;
    left: 20px;"></iframe>

	<script>

		var cvs, input, pen, frame, tr;

		cvs = new fil.Canvas();
		input = new fil.Input();
		pen = new fil.Pen();
		frame = new fil.Frame();
		tr = new fil.Transformer();

		// Custom ajax function to avoid using jQuery (°-°)
		var ajax = function (url, callback) {
			url = "http://jsonp.jit.su/?url=" + url;
			var xhr = new XMLHttpRequest();
			xhr.open('GET', url, true);
			xhr.send();
			xhr.onreadystatechange = function (e) {
				if (e.target.status === 200 && e.target.readyState === 4) {
					callback(JSON.parse(e.target.response));
				}
			};
		};

		var buildGithubTree = function (repo) {

			var self = this,
				distance = 70,
				rad = 20;

			this.level = 0;
			this.struct = [];
			this.c = {};
			this.el = document.getElementById('tooltip');
			this.timeout = false;

			this.distance = function (f, t) {
				var dx = f.x - t.x,
					dy = f.y - t.y;
				return Math.sqrt( dx * dx + dy * dy );
			};

			this.update = function (c) {
				this.c = c;
				this.changePosition(this.struct, true);
				this.drawTree(this.struct);

			};

			this.setItemPosition = function (item, pos, angle) {
				var self = this;

				item.pos = {
					x : pos.x,
					y : pos.y,
					_x : angle._x,
					_y : angle._y,
					level : self.level
				};
				return item;
			};

			this.changePosition = function (items, first) {

				var item,
					parent,
					angle,
					i,
					rand = Math.random() * 360;

				if (first) {
					self.level = 0;
				}

				for (i = 0; i < items.length; i++) {

					item = items[i].item;
					parent = items[i].parent.item;

					angle = ((i / items.length) * 360) + rand;

					item.angle = {
						_x : 10 * Math.cos(angle * Math.PI / 180),
						_y : 10 * Math.sin(angle * Math.PI / 180)
					};

					if (!item.pos) {
						self.setItemPosition(item, parent.pos, item.angle);
					}

					item.max = (item.type === 'dir' ? 100 : 50) + items.length;
					item.distance = this.distance(item.pos, parent.pos);
					// item.diff = Math.ceil(item.max - item.distance);

					if (item.distance <= item.max) {
						item.pos.x += item.pos._x;
						item.pos.y += item.pos._y;
					}

					if (items[i].children) {
						self.level += 1;
						self.changePosition(items[i].children);
					}
				}

				// this.drawTree(items);

				item = null;
				parent = null;
				angle = null;
				rand = null;
				i = null;
			};

			this.showToolTip = function (c, item) {

				c.x = Math.ceil(c.x);
				c.y = Math.ceil(c.y);

				pen.circle(c, 12);

				this.el.textContent = item.name;
				this.el.textContent +=  (item.type === "dir") ? '/' : '';
				this.el.style.backgroundColor = 'rgb(' + ((item.pos.level / self.level) * 255) + ',0,0)';

				tr.transform(this.el, {
					translateX : c.x + 'px',
					translateY : c.y + 'px'
				});

			};

			this.drawTree = function (items) {
				for (var i = 0; i < items.length; i++) {

					var node = items[i];

					if (node.item.pos) {

						if (typeof this.c.x !== 'undefined' && typeof this.c.y !== 'undefined') {

							if ((this.c.x > node.item.pos.x - rad && this.c.x < node.item.pos.x + rad) && (this.c.y > node.item.pos.y - rad && this.c.y < node.item.pos.y + rad)) {
								this.showToolTip(node.item.pos, node.item);
							}

						}

						pen.stroke('rgb(' + Math.ceil((node.item.pos.level / self.level) * 255) + ',0,0)');
						pen.fill('rgb(' + Math.ceil((node.item.pos.level / self.level) * 255) + ',0,0)');
						pen.line(node.item.pos, node.parent.item.pos);
						pen.circle(node.item.pos, node.item.type === 'dir' ? 10 : 5);
					}

					if (node.children) {
						self.drawTree(node.children);
					}

					item = null;

				}
			};

			this.addBranch = function (array, item) {
				ajax(item._links.self + '?cacheBust=' + (new Date()).getTime(), function (data) {
					self.processTree(array.children, data, array);
				});
			};

			this.processTree = function (array, items, parent) {

				var item, i;

				for (i = 0; i < items.length; i++) {

					item = items[i];

					array[i] = { item : item };

					if (item.type === 'dir') {
						array[i].children = [];
						self.addBranch(array[i], array[i].item);
					}

					array[i].parent = parent ? parent : false;

				}

			};

			if (typeof repo === 'undefined') {
				repo = 'dannygarcia/fil';
			}

			ajax('https://api.github.com/repos/' + repo + '/contents/?cacheBust=' + (new Date()).getTime(), function (data) {
				self.processTree(self.struct, data, {
					item : {
						pos : {
							x : cvs.width / 2,
							y : cvs.height / 2,
							_x : 0,
							_y : 0,
							level : 0
						}
					}
				});
			});

		};

		var node = function (pos, item) {

			this.pos = pos;

			this.draw = function (ctx) {

				pen.circle(this.pos, item.type === 'folder' ? 10 : 5);

			};

		};

		var init = function () {

			var canvasEl = document.getElementById('canvas'),
				form = document.getElementById('form'),
				tree,
				hash = false;

			form.addEventListener('submit', function (e) {
				e.preventDefault();

				var user = document.getElementById('user').value,
					repo = document.getElementById('repo').value,
					dir = user + '/' + repo;

				tree = new buildGithubTree(dir);

				// set url
				window.location.hash = dir;

			}, false);

			// Start tracking mouse input on the whole doc.
			input.init({
				ratio : false
			});

			// Initialize the canvas.
			cvs.init({
				container : canvasEl,
				ratio : false
			});

			// Prep the context.
			var ctx = cvs.context();
			ctx.lineStroke = '#000';
			pen.context(ctx);

			var prev = {},
				curr = {};

			// input.ontapstart = function (average) {
			//	pen.circle(average, 10);
			// };

			input.ontapmove = function (average) {
				curr = average;
			};

			// input.ontapend = function (average) {
			//	pen.circle(average, 10);
			// };

			if (window.location.hash) {
				hash = window.location.hash.replace('#', '');
				tree = new buildGithubTree(hash);
				document.getElementById('user').value = hash.split('/')[0];
				document.getElementById('repo').value = hash.split('/')[1];
			} else {
				tree = new buildGithubTree();
			}


			frame.start();
			frame.step = function (f) {

				cvs.clear();

				tree.update(curr);

				// prev = curr;

				// if (f > 30) {
					// frame.stop();
				// }

			};

		};

		init();

	</script>

</body>
</html>
